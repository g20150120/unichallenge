<!DOCTYPE html>
<html>
<head>
	<title>Register</title>
	
  <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
	<link rel="stylesheet" type="text/css" href="/stylesheets/homepage.css">
	<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css">
  
  <style type="text/css">
    body {
      margin-top: 61px;
      margin-bottom: 61px;
      padding-top: 30px;
  		padding-left: 250px;
  		padding-right: 250px;
  		background-color: rgb(235, 238, 238);
    }
    form {
    	font-size: 22px;
    }
    button {
      color: white;
    }
    input {
    	font-color: black;
    }
    
  </style>
	
  <script src="/javascripts/jquery.js"></script>

</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-xs-2"></div>
      <div class="col-xs-10">
      	<form id="form_register" name="register" method="post" action="/register_post" onsubmit="return Submit()">
      		<span>Email </span>
      		<input id="id_email" type="text" placeholder="example@gmail.com" name="email">

      		<span>Password </span>
      		<input id="id_pwd" type="password" placeholder="enter your password" name="password">

      		<span>Confirm your password </span>
      		<input id="id_confirm" type="password" placeholder="confirm your password">

      		<span>Nickname </span>
      		<input id="id_nickname" type="text" placeholder="g20150120" name="nickname">

      		<span>Gender </span>
      		<select name="gender">
      			<option value="male">Male</option>
      			<option value="female">Female</option>
      		</select>
          <br>

      		<span>School </span>
      		<input id="id_school" type="text" placeholder="DulwichCollege Suzhou" name="school">

      		<span>Description </span>
      		<textarea id="id_des" cols="20" rows="15" name="description" placeholder="Describe yourself"></textarea>
      		
      		<span>Verification code </span>
      		<input id="id_code" type="text" placeholder="enter the code sent to your email address" style="width: 300px;">

      		<button id="id_submit">Get code</button>
      	</form>
      	<br>
      	<br>
      	<a href="/">Back</a>
      </div>
    </div>
  </div>
	<script type="text/javascript">
		var status = 'Get code'

		var CheckNull = function() {
			var ids = ['email', 'pwd', 'confirm', 'nickname', 'des', 'school']
			for(var i=0; i<ids.length; i++) {
				if(document.getElementById('id_' + ids[i]).value == "") {
					alert('Please fill in all information needed!')
					return false
				}
			}
			return true
		}

		// send GET request
		var httpGet = function(url, addr) {
			$.get(url, {'email':addr})
		} 

		// hash string into int
		var hashCode = function(s) {
			var h = 0
			if (h == 0 && s.length > 0) {
				for(var i = 0; i < s.length && i < 4; i++) {
				    h = 31 * h + s[i].charCodeAt()
				}
			}
			return h
		}

		var Submit = function() {
			var email = document.getElementById('id_email').value
			var pwd = document.getElementById('id_pwd').value
			var confirm = document.getElementById('id_confirm').value
			var validEmail = email.indexOf('@') > 0 && email.split('@')[1].indexOf('.') > 0
			var code = document.getElementById('id_code').value

			if(status == 'Get code') {
				if(CheckNull()) {				
					if(!validEmail) {
						alert('The email address is not valid!')
						return false
					}
					if(pwd.length < 6) {
						alert('Password length should >= 6!')
						return false
					}
					if(pwd != confirm) {
						alert('Please confirm your password!')
						return false
					}
					httpGet('verification_get', email)
					status = 'Submit'
					document.getElementById('id_submit').innerHTML = status
					return false
			    }
				return false
			} else if(status == 'Submit') {
				if(code == "") {
					alert('Please enter the code sent to your email address!')
				}
				if(hashCode(email).toString() != code) {
					alert('Wrong verification code!')
					return false
				}
				return true
			}
			
		}
	</script>
</body>
</html>

















